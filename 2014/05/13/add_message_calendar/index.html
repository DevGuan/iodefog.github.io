<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>将事件添加到系统日历中，并且添加到提醒事项中</title><link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/img/header.jpg"></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Coding的小学生</a></li><li class="menu-item"><a href="/archives" class="menu-link">目录</a></li><li class="menu-item"><a href="/github" class="menu-link">GitHub</a></li><li class="menu-item"><a href="/about" class="menu-link">关于</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Coding的小学生</a></li><li class="menu-item"><a href="/archives" class="menu-link">目录</a></li><li class="menu-item"><a href="/github" class="menu-link">GitHub</a></li><li class="menu-item"><a href="/about" class="menu-link">关于</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">将事件添加到系统日历中，并且添加到提醒事项中</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title">发表于: </span>2014-05-13</p><p class="meta-item meta-category"><span class="meta-item-title">分类于: </span><a href="/categories/技术/" target="_blank" class="category-link">技术</a></p></div><div class="article-content"><p>具体代码如下（代码来着网路）：</p>
<p>/<em><br>1.0版本示例<br>初始建立将事件添加到系统日历中，并且添加到提醒事项中
 </em>/<br><a id="more"></a><br>/<em>代码示例<br> NSDate</em>startData=[NSDate dateWithTimeIntervalSinceNow:10];<br> NSDate<em>endDate=[NSDate dateWithTimeIntervalSinceNow:20];<br> //设置事件之前多长时候开始提醒<br> float alarmFloat=-5;<br> NSString</em>eventTitle=@”提醒事件标题”;<br> NSString*locationStr=@”提醒副标题”;<br> //isReminder是否写入提醒事项<br> [ZCActionOnCalendar saveEventStartDate:startData endDate:endDate alarm:alarmFloat eventTitle:eventTitle location:locationStr isReminder:YES];<br> 2014.4.29<br> //注意在参数第十八行需要设置不同的参数，然后进行判断是事件提醒还是日历事件<br> //EKEntityMaskEvent提醒事项参数（该参数只能真机使用）  EKEntityTypeEvent日历时间提醒参数</p>
<p> */</p>
<p>#import <foundation foundation.h=""></foundation></p>
<p>@interface ZCActionOnCalendar : NSObject</p>
<ul>
<li>(void)saveEventStartDate:(NSDate<em>)startData endDate:(NSDate</em>)endDate alarm:(float)alarm eventTitle:(NSString<em>)eventTitle location:(NSString</em>)location isReminder:(BOOL)isReminder;<br>@end</li>
</ul>
<p>#import “ZCActionOnCalendar.h”</p>
<p>#import <eventkit eventkit.h=""><br>@implementation ZCActionOnCalendar</eventkit></p>
<ul>
<li><p>(void)saveEventStartDate:(NSDate<em>)startData endDate:(NSDate</em>)endDate alarm:(float)alarm eventTitle:(NSString<em>)eventTitle location:(NSString</em>)location isReminder:(BOOL)isReminder{<br>  //事件市场<br>  EKEventStore *eventStore = [[EKEventStore alloc] init];<br>  //6.0及以上通过下⾯面⽅方式写⼊入事件<br>  if ([eventStore respondsToSelector:@selector(requestAccessToEntityType:completion:)]) {</p>
<pre><code>//等待用户是否同意授权日历
//EKEntityMaskEvent提醒事项参数（该参数只能真机使用）  EKEntityTypeEvent日历时间提醒参数
[eventStore requestAccessToEntityType:EKEntityTypeEvent completion:^(BOOL granted, NSError *error) {

    dispatch_async(dispatch_get_main_queue(), ^{
        if (error)
        {
        }else if (!granted)
        {
            //被⽤用户拒绝,不允许访问⽇日历

        }else{
            //事件保存到⽇日历
            //创建事件
            EKEvent *event = [EKEvent eventWithEventStore:eventStore];
            event.title = eventTitle;
            event.location = location;
            //设定事件开始时间
            //[NSDate dateWithTimeIntervalSinceNow:10];
            event.startDate=startData;

            //设定事件结束时间
            //[NSDate dateWithTimeIntervalSinceNow:20];
            event.endDate=endDate;
            //添加提醒可以添加多个，设定事件多久以前开始提醒
            // event.allDay = YES;
            //在事件前多少秒开始事件提醒-5.0f
            [event addAlarm:[EKAlarm alarmWithRelativeOffset:alarm]];

            [event setCalendar:[eventStore defaultCalendarForNewEvents]];
            NSError *err;
            [eventStore saveEvent:event span:EKSpanThisEvent error:&amp;err];
            NSLog(@&quot;保存成功&quot;);
</code></pre></li>
</ul>
<pre><code>                //是否写入提醒事项，提醒事项为iOS原生自带的，但是模拟器没有的
                if (isReminder) {
                    EKCalendar * iDefaultCalendar = [eventStore defaultCalendarForNewReminders];

                    EKReminder *reminder=[EKReminder reminderWithEventStore:eventStore];
                    reminder.calendar=[eventStore defaultCalendarForNewReminders];

                    reminder.title=eventTitle;
                    reminder.calendar = iDefaultCalendar;
                    EKAlarm *alarm=[EKAlarm alarmWithAbsoluteDate:[NSDate dateWithTimeIntervalSinceNow:-10]];
                    [reminder addAlarm:alarm];
                    NSError *error=nil;


                    [eventStore saveReminder:reminder commit:YES error:&amp;error];
                    if (error) {

                        NSLog(@&quot;error=%@&quot;,error);

                    }

                }
            }

        });
    }];

}else{
    //4.0和5.0通过下述⽅方式添加无需判断用户是否同意访问日历
    //事件保存到⽇日历
    //创建事件
    EKEvent *event = [EKEvent eventWithEventStore:eventStore];
    event.title = eventTitle;
    event.location = location;
    //设定事件开始时间
    //[NSDate dateWithTimeIntervalSinceNow:10];
    event.startDate=startData;

    //设定事件结束时间
    //[NSDate dateWithTimeIntervalSinceNow:20];
    event.endDate=endDate;
    //添加提醒可以添加多个，设定事件多久以前开始提醒
    // event.allDay = YES;
    //在事件前多少秒开始事件提醒-5.0f
    [event addAlarm:[EKAlarm alarmWithRelativeOffset:alarm]];

    [event setCalendar:[eventStore defaultCalendarForNewEvents]];
    NSError *err;
    [eventStore saveEvent:event span:EKSpanThisEvent error:&amp;err];
    NSLog(@&quot;保存成功&quot;);

    //是否写入提醒事项，提醒事项为iOS原生自带的，但是模拟器没有的
    if (isReminder) {
        EKCalendar * iDefaultCalendar = [eventStore defaultCalendarForNewReminders];
        EKReminder *reminder=[EKReminder reminderWithEventStore:eventStore];
        reminder.calendar=[eventStore defaultCalendarForNewReminders];
        reminder.title=eventTitle;
        reminder.calendar = iDefaultCalendar;
        EKAlarm *alarm=[EKAlarm alarmWithAbsoluteDate:[NSDate dateWithTimeIntervalSinceNow:-10]];
        [reminder addAlarm:alarm];
        NSError *error=nil; 
        [eventStore saveReminder:reminder commit:YES error:&amp;error];
        if (error) {
            NSLog(@&quot;error=%@&quot;,error);
        }
    }
}
</code></pre><p>}</p>
<p>需要的类库：UIEventKit.framework</p>
</div></article><div id="base-discus"></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Coding的小学生 Using </span><a href="https://github.com/chuguixin/Simple"><span>Simple</span></a><span> Presents For You.</span></div></footer><div class="dom-ready"><script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="/js/base.js"></script></div></body></html>