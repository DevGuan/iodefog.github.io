<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>ios 读取大文件</title><link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="/img/header.jpg"></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Coding的小学生</a></li><li class="menu-item"><a href="/archives" class="menu-link">目录</a></li><li class="menu-item"><a href="/about" class="menu-link">关于</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Coding的小学生</a></li><li class="menu-item"><a href="/archives" class="menu-link">目录</a></li><li class="menu-item"><a href="/about" class="menu-link">关于</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">ios 读取大文件</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title">发表于: </span>2015-08-07</p><p class="meta-item meta-category"><span class="meta-item-title">分类于: </span><a href="/categories/技术/" target="_blank" class="category-link">技术</a></p></div><div class="article-content"><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//读取文件内容操作- (void) loadFileContentsIntoTextView&#123;</span></div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">//通过流打开一个文件</span></div><div class="line"> </div><div class="line"><span class="built_in">NSInputStream</span> *inputStream = [[<span class="built_in">NSInputStream</span> alloc] initWithFileAtPath: filePath];</div><div class="line"> </div><div class="line">[inputStream open];</div><div class="line"></div><div class="line"><span class="built_in">NSInteger</span> maxLength = <span class="number">128</span>;</div><div class="line">uint8_t readBuffer [maxLength];</div><div class="line"><span class="comment">//是否已经到结尾标识</span></div><div class="line"><span class="built_in">BOOL</span> endOfStreamReached = <span class="literal">NO</span>;</div><div class="line"><span class="comment">// <span class="doctag">NOTE:</span> this tight loop will block until stream ends</span></div><div class="line"><span class="keyword">while</span> (! endOfStreamReached)</div><div class="line">&#123;</div><div class="line"><span class="built_in">NSInteger</span> bytesRead = [inputStream read: readBuffer maxLength:maxLength];</div><div class="line"><span class="keyword">if</span> (bytesRead == <span class="number">0</span>)</div><div class="line">&#123;<span class="comment">//文件读取到最后</span></div><div class="line">endOfStreamReached = <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (bytesRead == <span class="number">-1</span>)</div><div class="line">&#123;<span class="comment">//文件读取错误</span></div><div class="line">endOfStreamReached = <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">&#123;</div><div class="line"><span class="built_in">NSString</span> *readBufferString =[[<span class="built_in">NSString</span> alloc] initWithBytesNoCopy: readBuffer length: bytesRead encoding: <span class="built_in">NSUTF8StringEncoding</span> freeWhenDone: <span class="literal">NO</span>];   </div><div class="line"><span class="comment">//将字符不断的加载到视图</span></div><div class="line">[<span class="keyword">self</span> appendTextToView: readBufferString];</div><div class="line">[readBufferString release];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">[inputStream close];</div><div class="line">[inputStream release];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>异步文件的读取 ，在网络方面，由于网络的不可靠性可能会造成NSFileManager的文件操作方法的阻塞，而以流的方式进行操作则可以实现异步的读取。NSStream是可以异步工作的。可以注册一个在流中有字节可读的时候回调的函数，如果没有可读的，就不要阻塞住，回调出去。</p>
</div></article><div id="base-discus"></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Coding的小学生 Using </span><a href="https://github.com/chuguixin/Simple"><span>Simple</span></a><span> Presents For You.</span></div></footer><div class="dom-ready"><script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="/js/base.js"></script></div></body></html>